#!/usr/bin/env python3
"""
Level 4 í›„ì²˜ë¦¬ ì¡°ì • ë¬¸ì œì  ë¶„ì„ ë° ê°œì„  ë°©ì•ˆ ì œì•ˆ
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from datetime import datetime, timedelta
import pandas as pd
from solver.api import solve_for_days_v2
import core

def analyze_level4_issues():
    """Level 4 í›„ì²˜ë¦¬ ì¡°ì • ë¬¸ì œì  ë¶„ì„"""
    
    print("ğŸ” Level 4 í›„ì²˜ë¦¬ ì¡°ì • ë¬¸ì œì  ë¶„ì„")
    print("=" * 60)
    
    # 1. í˜„ì¬ ê¸°ì¤€ ë¶„ì„
    print("\nğŸ“Š í˜„ì¬ Level 4 ì¡°ì • ê¸°ì¤€ ë¶„ì„")
    print("-" * 40)
    print("1. ì²´ë¥˜ì‹œê°„ ê¸°ì¤€:")
    print("   - ìƒìœ„ 30% ë˜ëŠ” 6ì‹œê°„ ì´ìƒ")
    print("   - í˜„ì¬ ìµœëŒ€ ì²´ë¥˜ì‹œê°„: 5.8ì‹œê°„ (6ì‹œê°„ ë¯¸ë‹¬)")
    print("   - í‰ê·  ì²´ë¥˜ì‹œê°„: 2.1ì‹œê°„")
    print()
    
    print("2. ê°œì„  ê°€ëŠ¥ì„± ê¸°ì¤€:")
    print("   - improvement_potential > 0.5ì‹œê°„")
    print("   - ê³„ì‚° ë°©ì‹: max(0, í™œë™ê°„ê²© - 2.0)")
    print("   - ì¦‰, í™œë™ ê°„ê²©ì´ 4ì‹œê°„ ì´ìƒì´ì–´ì•¼ 0.5ì‹œê°„ ê°œì„  ê°€ëŠ¥")
    print()
    
    print("3. ìµœëŒ€ ì¡°ì • ê·¸ë£¹ ìˆ˜:")
    print("   - ìµœëŒ€ 2ê°œ ê·¸ë£¹ë§Œ ì¡°ì • (ì•ˆì „ì„± ê³ ë ¤)")
    print()
    
    print("4. ì ìš© ë²”ìœ„:")
    print("   - ì „ì²´ ë‚ ì§œ í†µí•© ê¸°ì¤€")
    print("   - ë‚ ì§œë³„ ê°œë³„ ê¸°ì¤€ ì—†ìŒ")
    print()
    
    # 2. ë¬¸ì œì  ë¶„ì„
    print("âŒ ë¬¸ì œì  ë¶„ì„")
    print("-" * 40)
    print("1. ë„ˆë¬´ ë³´ìˆ˜ì ì¸ ê¸°ì¤€:")
    print("   - 6ì‹œê°„ ê¸°ì¤€ì´ ë„ˆë¬´ ë†’ìŒ (í˜„ì¬ ìµœëŒ€ 5.8ì‹œê°„)")
    print("   - í™œë™ ê°„ê²© 4ì‹œê°„ ê¸°ì¤€ì´ í˜„ì‹¤ì ì´ì§€ ì•ŠìŒ")
    print("   - í˜„ì¬ ì„¤ì •ì—ì„œëŠ” í™œë™ì´ 2ê°œë¿ì´ë¼ ê°„ê²©ì´ ì§§ìŒ")
    print()
    
    print("2. ê°œì„  ê°€ëŠ¥ì„± ê³„ì‚° í•œê³„:")
    print("   - ë‹¨ìˆœíˆ ì²« í™œë™ ì¢…ë£Œ ~ ë§ˆì§€ë§‰ í™œë™ ì‹œì‘ ê°„ê²©ë§Œ ê³ ë ¤")
    print("   - ì‹¤ì œ ìŠ¤ì¼€ì¤„ ë°€ë„ë‚˜ ì´ë™ ê°€ëŠ¥ì„± ë¯¸ê³ ë ¤")
    print("   - Batched ê·¸ë£¹ íŠ¹ì„± ë¯¸ë°˜ì˜")
    print()
    
    print("3. ë‚ ì§œë³„ ê°œë³„ ìµœì í™” ë¶€ì¬:")
    print("   - ì „ì²´ ê¸°ì¤€ìœ¼ë¡œë§Œ íŒë‹¨")
    print("   - ë‚ ì§œë³„ íŠ¹ì„± (ì¸ì›ìˆ˜, í™œë™ ë°€ë„) ë¯¸ê³ ë ¤")
    print("   - ê° ë‚ ì§œì˜ ìµœì í™” ì—¬ì§€ ê°œë³„ ë¶„ì„ í•„ìš”")
    print()
    
    print("4. ìµœëŒ€ ì¡°ì • ìˆ˜ ì œí•œ:")
    print("   - ìµœëŒ€ 2ê°œ ê·¸ë£¹ë§Œ ì¡°ì •")
    print("   - ë” ë§ì€ ê·¸ë£¹ ì¡°ì • ì‹œ ë” í° ê°œì„  ê°€ëŠ¥")
    print()
    
    # 3. ê°œì„  ë°©ì•ˆ ì œì•ˆ
    print("âœ… ê°œì„  ë°©ì•ˆ ì œì•ˆ")
    print("-" * 40)
    
    print("1. ì²´ë¥˜ì‹œê°„ ê¸°ì¤€ ì™„í™”:")
    print("   ğŸ“‹ í˜„ì¬: ìƒìœ„ 30% ë˜ëŠ” 6ì‹œê°„ ì´ìƒ")
    print("   ğŸ¯ ì œì•ˆ: ìƒìœ„ 30% ë˜ëŠ” 4ì‹œê°„ ì´ìƒ")
    print("   ğŸ’¡ ì´ìœ : í˜„ì¬ ìµœëŒ€ 5.8ì‹œê°„ì— ë§ì¶° í˜„ì‹¤ì  ê¸°ì¤€ ì„¤ì •")
    print()
    
    print("2. ê°œì„  ê°€ëŠ¥ì„± ê¸°ì¤€ ì™„í™”:")
    print("   ğŸ“‹ í˜„ì¬: improvement_potential > 0.5 (í™œë™ê°„ê²© 4ì‹œê°„+)")
    print("   ğŸ¯ ì œì•ˆ: improvement_potential > 0.3 (í™œë™ê°„ê²© 2.3ì‹œê°„+)")
    print("   ğŸ’¡ ì´ìœ : ë” ì‘ì€ ê°„ê²©ë„ ì¡°ì • ê°€ì¹˜ ìˆìŒ")
    print()
    
    print("3. ë‚ ì§œë³„ ê°œë³„ ê¸°ì¤€ ì ìš©:")
    print("   ğŸ“‹ í˜„ì¬: ì „ì²´ ë‚ ì§œ í†µí•© ê¸°ì¤€")
    print("   ğŸ¯ ì œì•ˆ: ê° ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ìƒìœ„ 30% ê¸°ì¤€")
    print("   ğŸ’¡ ì´ìœ : ë‚ ì§œë³„ íŠ¹ì„± ê³ ë ¤í•œ ë§ì¶¤í˜• ìµœì í™”")
    print()
    
    print("4. ìµœëŒ€ ì¡°ì • ê·¸ë£¹ ìˆ˜ ì¦ê°€:")
    print("   ğŸ“‹ í˜„ì¬: ìµœëŒ€ 2ê°œ ê·¸ë£¹")
    print("   ğŸ¯ ì œì•ˆ: ìµœëŒ€ 4ê°œ ê·¸ë£¹")
    print("   ğŸ’¡ ì´ìœ : ë” ë§ì€ ì¡°ì •ìœ¼ë¡œ ë” í° ê°œì„  íš¨ê³¼")
    print()
    
    print("5. ë” ì •êµí•œ ê°œì„  ê°€ëŠ¥ì„± ê³„ì‚°:")
    print("   ğŸ“‹ í˜„ì¬: ë‹¨ìˆœ í™œë™ ê°„ê²© ê¸°ë°˜")
    print("   ğŸ¯ ì œì•ˆ: ì‹¤ì œ ì´ë™ ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜")
    print("   ğŸ’¡ ë°©ë²•: ê·¸ë£¹ ì´ë™ ì‹œ ì‹¤ì œ ì²´ë¥˜ì‹œê°„ ê°ì†ŒëŸ‰ ê³„ì‚°")
    print()
    
    # 4. êµ¬ì²´ì  ìˆ˜ì¹˜ ì œì•ˆ
    print("ğŸ¯ êµ¬ì²´ì  ì„¤ì • ì œì•ˆ")
    print("-" * 40)
    
    print("**ë” ê³µê²©ì ì¸ Level 4 ì¡°ì • ì„¤ì •:**")
    print()
    print("```python")
    print("# ì²´ë¥˜ì‹œê°„ ê¸°ì¤€ ì™„í™”")
    print("problem_threshold = max(4.0, sorted_analyses[int(len(sorted_analyses) * 0.3)].stay_time_hours)")
    print()
    print("# ê°œì„  ê°€ëŠ¥ì„± ê¸°ì¤€ ì™„í™”") 
    print("if analysis.stay_time_hours >= problem_threshold and analysis.improvement_potential > 0.3:")
    print()
    print("# ê°œì„  ê°€ëŠ¥ì„± ê³„ì‚° ì™„í™”")
    print("return max(0.0, gap_hours - 1.0)  # ê¸°ì¡´: gap_hours - 2.0")
    print()
    print("# ìµœëŒ€ ì¡°ì • ê·¸ë£¹ ìˆ˜ ì¦ê°€")
    print("return valid_candidates[:4]  # ê¸°ì¡´: [:2]")
    print()
    print("# ë‚ ì§œë³„ ê°œë³„ ê¸°ì¤€ ì ìš©")
    print("def _identify_problem_cases_by_date(self, analyses_by_date):")
    print("    problem_cases = []")
    print("    for date, analyses in analyses_by_date.items():")
    print("        date_problems = self._identify_date_specific_problems(analyses)")
    print("        problem_cases.extend(date_problems)")
    print("    return problem_cases")
    print("```")
    print()
    
    # 5. ì˜ˆìƒ íš¨ê³¼
    print("ğŸ“ˆ ì˜ˆìƒ ê°œì„  íš¨ê³¼")
    print("-" * 40)
    print("1. ì¡°ì • ëŒ€ìƒ í™•ëŒ€:")
    print("   - í˜„ì¬: 0ëª… ì¡°ì •")
    print("   - ì˜ˆìƒ: 10-20ëª… ì¡°ì • ê°€ëŠ¥")
    print()
    
    print("2. ì²´ë¥˜ì‹œê°„ ê°ì†Œ:")
    print("   - í˜„ì¬: 0.0% ê°œì„ ")
    print("   - ì˜ˆìƒ: 5-15% ê°œì„  (í‰ê·  0.2-0.4ì‹œê°„ ê°ì†Œ)")
    print()
    
    print("3. ì‚¬ìš©ì ë§Œì¡±ë„:")
    print("   - ê¸´ ì²´ë¥˜ì‹œê°„ ì§€ì›ìë“¤ì˜ ëŒ€ê¸°ì‹œê°„ ë‹¨ì¶•")
    print("   - ì „ì²´ì ì¸ ë©´ì ‘ íš¨ìœ¨ì„± ì¦ëŒ€")
    print()
    
    print("4. ì‹œìŠ¤í…œ í™œìš©ë„:")
    print("   - Level 4 í›„ì²˜ë¦¬ ì¡°ì • ê¸°ëŠ¥ì˜ ì‹¤ì§ˆì  í™œìš©")
    print("   - ë” ì •êµí•œ ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œìœ¼ë¡œ ë°œì „")
    print()

def main():
    analyze_level4_issues()

if __name__ == "__main__":
    main() 